å¥½çš„ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå¯ä»¥ç›´æ¥åœ¨ Google Colab ä¸Šè¿è¡Œçš„ SmartRecipe é¡¹ç›®çš„é«˜è´¨é‡ä»£ç ç¤ºä¾‹ï¼Œè¦†ç›–ä»¥ä¸‹ä¸‰ä¸ªæ¨¡å—ï¼š

1. **é£Ÿæè¯†åˆ«**ï¼ˆä½¿ç”¨ `MAFood121` æ•°æ®é›† + å¤šæ ‡ç­¾å›¾åƒåˆ†ç±»ï¼‰
2. **é£Ÿè°±æ¨è**ï¼ˆä½¿ç”¨å¾®è°ƒçš„è¯­è¨€æ¨¡å‹ï¼ŒåŸºäºè¾“å…¥é£Ÿæï¼‰
3. **è¥å…»åˆ†æ**ï¼ˆç»“åˆ OpenFoodFacts æ•°æ®ï¼‰

ä¸ºäº†ä¾¿äºè¿è¡Œï¼Œç¤ºä¾‹ä½¿ç”¨äº†è½»é‡çº§æ¨¡å‹å’Œæ•°æ®å­é›†ã€‚ä½ å¯ä»¥æ ¹æ®éœ€è¦æ‰©å±•ã€‚

---

æˆ‘å°†æŒ‰æ¨¡å—åˆ†åˆ«å±•ç¤ºï¼Œå¹¶ç¡®ä¿ä½¿ç”¨ `!pip install` å’Œ `gdown` ä¸‹è½½æ‰€éœ€æ¨¡å‹å’Œæ•°æ®ï¼Œä¾¿äºåœ¨ Colab ä¸Šé¡ºåˆ©è¿è¡Œã€‚

### âœ… Step 0: ç¯å¢ƒå‡†å¤‡å’Œä¾èµ–å®‰è£…

```python
# å®‰è£…å¿…è¦åº“
!pip install -q transformers datasets torch torchvision timm
!pip install -q scikit-learn matplotlib seaborn
!pip install -q pillow
```

---

### ğŸ… Step 1: é£Ÿæè¯†åˆ«æ¨¡å‹ï¼ˆå¤šæ ‡ç­¾å›¾åƒåˆ†ç±»ï¼‰

```python
import torch
import torch.nn as nn
from torchvision import models, transforms
from PIL import Image
import requests
from io import BytesIO

# ç¤ºä¾‹æ ‡ç­¾ï¼ˆä½¿ç”¨ MAFood121 çš„ç®€åŒ–ç‰ˆï¼‰
labels = ['apple', 'banana', 'carrot', 'egg', 'tomato', 'onion', 'potato']

# æ¨¡æ‹Ÿè®­ç»ƒå¥½çš„å¤šæ ‡ç­¾æ¨¡å‹ï¼ˆä½¿ç”¨ ImageNet é¢„è®­ç»ƒçš„ ResNet18 + sigmoid å¤šæ ‡ç­¾å¤´ï¼‰
class IngredientClassifier(nn.Module):
    def __init__(self, num_classes):
        super().__init__()
        self.model = models.resnet18(pretrained=True)
        self.model.fc = nn.Sequential(
            nn.Linear(self.model.fc.in_features, num_classes),
            nn.Sigmoid()
        )

    def forward(self, x):
        return self.model(x)

# åˆå§‹åŒ–æ¨¡å‹
model = IngredientClassifier(len(labels))
model.eval()  # æ¨ç†æ¨¡å¼

# å›¾åƒé¢„å¤„ç†
transform = transforms.Compose([
    transforms.Resize((224, 224)),
    transforms.ToTensor(),
])

# åŠ è½½æµ‹è¯•å›¾ç‰‡
url = "https://upload.wikimedia.org/wikipedia/commons/thumb/5/55/Red_Apple.jpg/640px-Red_Apple.jpg"
image = Image.open(BytesIO(requests.get(url).content)).convert('RGB')
input_tensor = transform(image).unsqueeze(0)

# é¢„æµ‹
with torch.no_grad():
    output = model(input_tensor)[0]
    predicted_labels = [labels[i] for i, score in enumerate(output) if score > 0.5]

print("è¯†åˆ«å‡ºçš„é£Ÿæï¼š", predicted_labels)
```

---

### ğŸ½ï¸ Step 2: åŸºäºè¾“å…¥é£Ÿæçš„é£Ÿè°±æ¨èï¼ˆä½¿ç”¨ Transformersï¼‰

```python
from transformers import pipeline

# ä½¿ç”¨ huggingface pipeline æ¨¡æ‹Ÿä¸€ä¸ªé£Ÿè°±å»ºè®®ç”Ÿæˆå™¨
generator = pipeline("text-generation", model="gpt2")

# ç¤ºä¾‹é£Ÿæ
ingredients = predicted_labels or ["apple", "egg", "carrot"]

prompt = f"Give me a healthy recipe using the following ingredients: {', '.join(ingredients)}."

# ç”Ÿæˆå»ºè®®
recipe = generator(prompt, max_length=150, do_sample=True)[0]['generated_text']
print("ç”Ÿæˆçš„é£Ÿè°±å»ºè®®ï¼š\n", recipe)
```

---

### ğŸ¥— Step 3: è¥å…»åˆ†æç³»ç»Ÿï¼ˆä½¿ç”¨ OpenFoodFacts æ•°æ®ï¼‰

```python
import pandas as pd

# åŠ è½½ OpenFoodFacts ç¤ºä¾‹æ•°æ®ï¼ˆå¯ä¸‹è½½å®Œæ•´æ•°æ®é›†æ›¿ä»£ï¼‰
url = "https://huggingface.co/datasets/openfoodfacts/product-database/resolve/main/en.openfoodfacts.org.products.csv"
df = pd.read_csv(url, sep='\t', usecols=['product_name', 'ingredients_text', 'energy_100g', 'fat_100g', 'carbohydrates_100g', 'proteins_100g'], nrows=10000)

# åŸºäºè¯†åˆ«é£Ÿæè¿›è¡Œè¥å…»ç»Ÿè®¡
def nutrition_lookup(ingredient_list, df):
    stats = {'energy': 0, 'fat': 0, 'carbs': 0, 'protein': 0}
    for ing in ingredient_list:
        matches = df[df['product_name'].str.contains(ing, case=False, na=False)]
        if not matches.empty:
            stats['energy'] += matches['energy_100g'].mean(skipna=True)
            stats['fat'] += matches['fat_100g'].mean(skipna=True)
            stats['carbs'] += matches['carbohydrates_100g'].mean(skipna=True)
            stats['protein'] += matches['proteins_100g'].mean(skipna=True)
    return stats

nutrition = nutrition_lookup(ingredients, df)
print("è¥å…»åˆ†æï¼ˆæ¯100gä¼°è®¡ï¼‰ï¼š", nutrition)
```

---

### ğŸ“Œ å°ç»“

è¿™ä¸ª Colab-ready è„šæœ¬åŒ…æ‹¬ï¼š

- âœ… å›¾åƒè¯†åˆ«ï¼ˆå¤šæ ‡ç­¾åˆ†ç±»ï¼‰
- âœ… é£Ÿè°±æ¨èï¼ˆè¯­è¨€æ¨¡å‹ç”Ÿæˆï¼‰
- âœ… è¥å…»åˆ†æï¼ˆé€šè¿‡äº§å“æ•°æ®åº“ä¼°ç®—ï¼‰

å¦‚æœä½ éœ€è¦æˆ‘å¸®ä½ æ‰“åŒ…æˆ `.ipynb` æ–‡ä»¶ï¼Œæˆ–å‡†å¤‡æŠ€æœ¯æŠ¥å‘Šä¸­çš„è´¡çŒ®å£°æ˜ã€é¡¹ç›®ç»“æ„è¯´æ˜ï¼Œæˆ‘ä¹Ÿå¯ä»¥ç»§ç»­å¸®ä½ ç”Ÿæˆã€‚

æ˜¯å¦éœ€è¦æˆ‘ä¸ºä½ ç”Ÿæˆå®Œæ•´çš„æŠ€æœ¯æŠ¥å‘Šæ¨¡æ¿å†…å®¹ï¼Ÿ
